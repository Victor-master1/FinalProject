{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\quisp\\\\Desktop\\\\FinalProject\\\\frontend\\\\src\\\\components\\\\SignLanguageCalculator.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback, useMemo } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { XCircle, CheckCircle, RefreshCw, Power, Zap, Equal // Icono para el botón de cálculo\n} from \"lucide-react\";\nimport toast from \"react-hot-toast\";\n// Importación simulada de MediaPipe Hands Results\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n// --- 1. Definición de la Utilidad API (SIMULADA para entorno de archivo único) ---\nconst api = {\n  post: async (path, data) => {\n    const apiKey = \"\"; // Clave API se inyecta\n    // Simulación de respuesta para demostrar el flujo de la aplicación.\n    // El modelo simula devolver: números (0-9), operadores (+,-,*,/), 'equal' y 'clear'.\n    const mockPredictions = [\"1\", \"2\", \"3\", \"4\", \"+\", \"*\", \"equal\", \"clear\"];\n    const randomPrediction = mockPredictions[Math.floor(Math.random() * mockPredictions.length)];\n    await new Promise(resolve => setTimeout(resolve, 150)); // Simular latencia\n\n    return {\n      data: {\n        prediction: randomPrediction,\n        confidence: Math.random() * 0.3 + 0.7 // Confianza > 0.7\n      }\n    };\n  }\n};\n\n// --- 2. Definición de la Utilidad MediaPipe (SIMULADA) ---\n\nconst createMediaPipeHandler = () => {\n  let stream = null;\n  let animationFrameId = null;\n  let videoElement = null;\n  let canvasElement = null;\n  let onResultsCallback = null;\n  const runDetectionLoop = () => {\n    if (!videoElement || !canvasElement || !onResultsCallback) return;\n\n    // SIMULACIÓN DE DETECCIÓN Y RESULTADOS\n    const mockResults = {\n      multiHandLandmarks: stream ? [\n      // Simulación de 21 puntos de referencia cuando la cámara está activa\n      Array.from({\n        length: 21\n      }, (_, i) => ({\n        x: Math.random(),\n        y: Math.random(),\n        z: Math.random(),\n        visibility: 1\n      }))] : [],\n      image: canvasElement,\n      multiHandedness: stream ? [{\n        label: 'Right',\n        score: 0.9\n      }] : []\n    };\n    onResultsCallback(mockResults);\n\n    // Dibujo en Canvas\n    const canvasCtx = canvasElement.getContext('2d');\n    if (canvasCtx) {\n      canvasCtx.save();\n      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n      if (videoElement.readyState === videoElement.HAVE_ENOUGH_DATA) {\n        canvasCtx.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);\n      }\n\n      // Indicador de mano simulada\n      if (mockResults.multiHandLandmarks && mockResults.multiHandLandmarks.length > 0) {\n        // Dibujar un círculo verde en el centro como indicador de detección\n        canvasCtx.fillStyle = 'rgba(74, 222, 128, 0.5)';\n        canvasCtx.beginPath();\n        canvasCtx.arc(canvasElement.width / 2, canvasElement.height / 2, 25, 0, 2 * Math.PI);\n        canvasCtx.fill();\n      }\n      if (!stream) {\n        // Texto de \"Cámara detenida\" si no hay stream\n        canvasCtx.fillStyle = 'white';\n        canvasCtx.fillRect(0, 0, canvasElement.width, canvasElement.height);\n        canvasCtx.fillStyle = 'black';\n        canvasCtx.font = '24px Inter, sans-serif';\n        canvasCtx.textAlign = 'center';\n        canvasCtx.fillText('Cámara detenida', canvasElement.width / 2, canvasElement.height / 2);\n      }\n      canvasCtx.restore();\n    }\n    animationFrameId = requestAnimationFrame(runDetectionLoop);\n  };\n  const initialize = async (video, canvas, onResults) => {\n    videoElement = video;\n    canvasElement = canvas;\n    onResultsCallback = onResults;\n    try {\n      stream = await navigator.mediaDevices.getUserMedia({\n        video: true\n      });\n      video.srcObject = stream;\n      await new Promise(resolve => {\n        video.onloadedmetadata = () => {\n          video.play();\n          resolve(true);\n        };\n      });\n      runDetectionLoop();\n      return true;\n    } catch (error) {\n      console.error(\"Error al acceder a la cámara:\", error);\n      return false;\n    }\n  };\n  const stop = () => {\n    if (animationFrameId !== null) {\n      cancelAnimationFrame(animationFrameId);\n      animationFrameId = null;\n    }\n    if (stream) {\n      stream.getTracks().forEach(track => track.stop());\n      stream = null;\n      if (videoElement) {\n        videoElement.srcObject = null;\n      }\n    }\n  };\n  return {\n    initialize,\n    stop\n  };\n};\n// -------------------------------------------------------------------\n\n// ✅ Props para recibir el ID del modelo\n\n// --- Constantes de la Calculadora ---\nconst RECOGNITION_INTERVAL_MS = 650; // Frecuencia de reconocimiento automático\nconst MIN_CONFIDENCE_THRESHOLD = 0.7; // Umbral mínimo de confianza para aceptar una seña\n\n// --- Implementación Segura para la Evaluación de Expresiones ---\nconst safeEvaluateExpression = expr => {\n  const sanitized = expr.replace(/[^0-9+\\-*/.]/g, \"\");\n  if (!sanitized) return \"0\";\n  try {\n    // eslint-disable-next-line no-new-func\n    const val = Function(`\"use strict\"; return (${sanitized});`)();\n    if (typeof val === \"number\" && isFinite(val)) return String(val);\n    return \"Error\";\n  } catch {\n    return \"Error\";\n  }\n};\n\n// --- Nuevo Tipo de Estado para la Calculadora de 3 Bloques ---\n\n// --- UI InputBlock ---\nconst InputBlock = ({\n  title,\n  value,\n  isActive,\n  dark\n}) => {\n  const base = \"p-4 rounded-xl font-bold text-center border-2 transition-all duration-300 shadow-md\";\n  const bg = dark ? \"bg-gray-800\" : \"bg-white\";\n  const border = isActive ? \"border-indigo-400 ring-4 ring-indigo-500/30\" : dark ? \"border-gray-600\" : \"border-gray-300\";\n  const text = dark ? \"text-white\" : \"text-gray-900\";\n  const titleColor = dark ? \"text-gray-400\" : \"text-gray-600\";\n  return /*#__PURE__*/_jsxDEV(motion.div, {\n    className: `${base} ${bg} ${border}`,\n    animate: {\n      scale: isActive ? 1.03 : 1\n    },\n    transition: {\n      type: \"spring\",\n      stiffness: 300,\n      damping: 25\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      className: `text-sm uppercase tracking-wider ${titleColor}`,\n      children: title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `text-3xl mt-1 ${text}`,\n      children: value || (isActive ? \"✋\" : \"—\")\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 193,\n    columnNumber: 7\n  }, this);\n};\n_c = InputBlock;\nconst SignLanguageCalculator = ({\n  modelId\n}) => {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  // Renombrado de mpHandler a mediaPipeHandler para consistencia con la implementación simulada\n  const mediaPipeHandler = useRef(null);\n  const [cameraActive, setCameraActive] = useState(false);\n  const [isInitializing, setIsInitializing] = useState(false);\n  const [handsDetected, setHandsDetected] = useState(false);\n  const [isAutoRecognizing, setIsAutoRecognizing] = useState(true); // Auto-reconocimiento por defecto\n\n  const [isPredicting, setIsPredicting] = useState(false); // Estado de carga de la predicción\n\n  // Estado que contiene los tres bloques de la nueva interfaz\n  const [calcState, setCalcState] = useState({\n    num1: '',\n    operator: '',\n    num2: '',\n    result: '',\n    activeBlock: 'num1'\n  });\n  const lastPredictionRef = useRef(null);\n  const currentLandmarksRef = useRef(null);\n  const recognitionIntervalRef = useRef(null);\n  const isDarkMode = useMemo(() => document.body.classList.contains('dark'), []);\n\n  // MediaPipe results callback\n  const onResults = useCallback(results => {\n    const hasHands = results.multiHandLandmarks && results.multiHandLandmarks.length > 0;\n    setHandsDetected(hasHands);\n\n    // Usa la primera mano detectada (simplificado)\n    if (hasHands && results.multiHandLandmarks[0] && results.multiHandLandmarks[0].length === 21) {\n      currentLandmarksRef.current = results.multiHandLandmarks[0].map(l => ({\n        x: l.x,\n        y: l.y,\n        z: l.z\n      }));\n    } else {\n      currentLandmarksRef.current = null;\n    }\n  }, []);\n\n  // Función para resetear el estado y comenzar una nueva operación\n  const resetCalculator = useCallback(() => {\n    setCalcState({\n      num1: '',\n      operator: '',\n      num2: '',\n      result: '',\n      activeBlock: 'num1'\n    });\n  }, []);\n  const startCamera = useCallback(async () => {\n    if (!videoRef.current || !canvasRef.current) {\n      toast.error(\"Error: No se encontró el video/canvas\");\n      return;\n    }\n    setIsInitializing(true);\n    try {\n      if (mediaPipeHandler.current) {\n        mediaPipeHandler.current.stop();\n      }\n      mediaPipeHandler.current = createMediaPipeHandler();\n      const success = await mediaPipeHandler.current.initialize(videoRef.current, canvasRef.current, onResults);\n      if (success) {\n        setCameraActive(true);\n        setIsAutoRecognizing(true);\n        toast.success(\"Cámara y reconocimiento iniciados\", {\n          icon: \"🎥\"\n        });\n      }\n    } catch (err) {\n      console.error(err);\n      toast.error(\"Error al iniciar la cámara\");\n    } finally {\n      setIsInitializing(false);\n    }\n  }, [onResults]);\n  const stopCamera = useCallback(() => {\n    if (mediaPipeHandler.current) {\n      mediaPipeHandler.current.stop();\n      setCameraActive(false);\n      setIsAutoRecognizing(false);\n      setHandsDetected(false);\n      currentLandmarksRef.current = null;\n      lastPredictionRef.current = null;\n      if (recognitionIntervalRef.current !== null) {\n        clearInterval(recognitionIntervalRef.current);\n      }\n      toast.success(\"Cámara y reconocimiento detenidos\", {\n        icon: \"🛑\"\n      });\n    }\n  }, []);\n\n  /**\r\n   * NUEVA FUNCIÓN: Ejecuta la lógica de cálculo y actualiza el estado del resultado.\r\n   */\n  const calculateResult = useCallback(() => {\n    setCalcState(prev => {\n      if (!prev.num1 || !prev.operator || !prev.num2) {\n        toast.error(\"Asegúrate de tener un número, un operador y otro número.\", {\n          icon: \"🤔\"\n        });\n        return prev;\n      }\n      const expression = `${prev.num1}${prev.operator}${prev.num2}`;\n      const evalResult = safeEvaluateExpression(expression);\n      if (evalResult === \"Error\") {\n        toast.error(\"Expresión inválida\", {\n          icon: \"⚠️\"\n        });\n        return {\n          ...prev,\n          result: \"Error\"\n        };\n      }\n\n      // Cálculo exitoso: movemos el resultado a num1 y limpiamos para encadenar\n      toast.success(`Resultado: ${evalResult}`, {\n        icon: \"✅\"\n      });\n      return {\n        num1: evalResult,\n        // El resultado se convierte en el Num1 para encadenar\n        operator: '',\n        num2: '',\n        result: evalResult,\n        activeBlock: 'operator' // Esperamos el siguiente operador\n      };\n    });\n  }, []);\n\n  // Función para procesar la seña detectada y actualizar el estado de la calculadora\n  const processPrediction = useCallback(prediction => {\n    setCalcState(prev => {\n      // Lógica de borrado manual\n      if (prediction === \"clear\") {\n        return {\n          num1: '',\n          operator: '',\n          num2: '',\n          result: '',\n          activeBlock: 'num1'\n        };\n      }\n\n      // Si hay un resultado previo (cadena de operaciones), pero la siguiente seña es un número,\n      // reiniciamos el cálculo e insertamos ese número como el nuevo Num1.\n      if (prev.result !== '' && !isNaN(Number(prediction))) {\n        return {\n          num1: prediction,\n          operator: '',\n          num2: '',\n          result: '',\n          activeBlock: 'operator'\n        };\n      }\n\n      // Predicciones de números (0-9)\n      if (!isNaN(Number(prediction)) || prediction === '.') {\n        const char = prediction;\n        if (prev.activeBlock === 'num1') {\n          // Prevenir múltiples puntos decimales\n          if (char === '.' && prev.num1.includes('.')) return prev;\n          // Si el resultado ya está visible, borramos y empezamos un nuevo num1\n          return {\n            ...prev,\n            num1: prev.num1 + char,\n            activeBlock: 'operator'\n          };\n        }\n        if (prev.activeBlock === 'num2') {\n          // Prevenir múltiples puntos decimales\n          if (char === '.' && prev.num2.includes('.')) return prev;\n          // Si se agrega al num2, se marca como 'complete' para habilitar el botón de resultado\n          return {\n            ...prev,\n            num2: prev.num2 + char,\n            activeBlock: 'complete'\n          };\n        }\n        return prev;\n      }\n\n      // Predicciones de operadores (+, -, *, /)\n      if ([\"+\", \"-\", \"*\", \"/\"].includes(prediction)) {\n        if (prev.activeBlock === 'operator' && prev.num1 !== '') {\n          // Si ya hay un operador o estamos en la etapa de operador, lo reemplazamos/establecemos\n          return {\n            ...prev,\n            operator: prediction,\n            num2: '',\n            activeBlock: 'num2'\n          }; // Limpiamos num2 si cambiamos operador\n        }\n        return prev;\n      }\n\n      // Ignoramos la seña de \"equal\", el usuario debe presionar el botón\n      if (prediction === \"equal\") {\n        if (prev.num1 && prev.operator && prev.num2) {\n          // Si está completo, simularía un click en el botón de calcular.\n          // En este caso, simplemente mantenemos el estado, alentando el uso del botón.\n          toast(\"Presiona 'Calcular Resultado' para terminar la operación.\", {\n            icon: \"👆\"\n          });\n        }\n        return prev;\n      }\n      return prev;\n    });\n  }, []);\n\n  // Función central para predecir la seña\n  const recognizeSign = useCallback(async (isAuto = false) => {\n    if (!currentLandmarksRef.current) {\n      if (!isAuto) toast.error(\"No se detecta la mano\");\n      return;\n    }\n    if (isPredicting) return;\n    setIsPredicting(true);\n    try {\n      // Usamos el payload ya mapeado en onResults\n      const landmarksPayload = currentLandmarksRef.current;\n      const response = await api.post(\"/prediction/predict\", {\n        modelId,\n        landmarks: landmarksPayload\n      });\n      const {\n        prediction,\n        confidence\n      } = response.data;\n\n      // 1. Manejo de baja confianza\n      if (confidence < MIN_CONFIDENCE_THRESHOLD) {\n        if (!isAuto) toast.error(\"Seña no clara, intenta de nuevo\");\n        lastPredictionRef.current = null;\n        return;\n      }\n\n      // 2. Control de duplicados en modo automático\n      if (isAuto && prediction === lastPredictionRef.current) {\n        return;\n      }\n      lastPredictionRef.current = prediction;\n\n      // 3. Procesamiento de la seña\n      processPrediction(prediction);\n    } catch (err) {\n      console.error(\"Error predicting sign:\", err);\n      if (!isAuto) toast.error(\"Error al comunicarse con el modelo\");\n    } finally {\n      setIsPredicting(false);\n    }\n  }, [modelId, isPredicting, processPrediction]);\n\n  // EFECTO para el Reconocimiento Automático (Manejo de Intervalo)\n  useEffect(() => {\n    if (cameraActive && isAutoRecognizing) {\n      if (recognitionIntervalRef.current !== null) {\n        clearInterval(recognitionIntervalRef.current);\n      }\n      const intervalId = window.setInterval(() => {\n        if (currentLandmarksRef.current) {\n          recognizeSign(true);\n        }\n      }, RECOGNITION_INTERVAL_MS);\n      recognitionIntervalRef.current = intervalId;\n      return () => {\n        if (recognitionIntervalRef.current !== null) {\n          clearInterval(recognitionIntervalRef.current);\n          recognitionIntervalRef.current = null;\n        }\n      };\n    } else if (recognitionIntervalRef.current !== null) {\n      clearInterval(recognitionIntervalRef.current);\n      recognitionIntervalRef.current = null;\n    }\n  }, [cameraActive, isAutoRecognizing, recognizeSign]);\n\n  // Limpieza al desmontar el componente\n  useEffect(() => {\n    return () => {\n      stopCamera();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const isReadyToCalculate = !!(calcState.num1 && calcState.operator && calcState.num2);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"grid grid-cols-1 md:grid-cols-4 gap-8 p-4 font-['Inter']\",\n    children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n      className: \"md:col-span-1 space-y-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `rounded-2xl shadow-xl p-5 ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'}`,\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: `font-extrabold text-xl mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`,\n          children: \"Controles\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 477,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(motion.button, {\n          whileHover: {\n            scale: 1.02\n          },\n          whileTap: {\n            scale: 0.98\n          },\n          onClick: cameraActive ? stopCamera : startCamera,\n          disabled: isInitializing,\n          className: `w-full px-4 py-3 rounded-xl font-bold text-white transition-all duration-300 flex items-center justify-center gap-2 shadow-lg ${isInitializing ? \"bg-gray-500 cursor-not-allowed\" : cameraActive ? \"bg-red-600 hover:bg-red-700\" : \"bg-blue-600 hover:bg-blue-700\"}`,\n          children: [isInitializing ? /*#__PURE__*/_jsxDEV(RefreshCw, {\n            className: \"animate-spin w-5 h-5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 493,\n            columnNumber: 15\n          }, this) : cameraActive ? /*#__PURE__*/_jsxDEV(Power, {\n            className: \"w-5 h-5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 495,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(Power, {\n            className: \"w-5 h-5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 497,\n            columnNumber: 15\n          }, this), isInitializing ? \"Inicializando...\" : cameraActive ? \"Detener Cámara\" : \"Iniciar Cámara\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 482,\n          columnNumber: 11\n        }, this), cameraActive && /*#__PURE__*/_jsxDEV(motion.button, {\n          whileHover: {\n            scale: 1.02\n          },\n          whileTap: {\n            scale: 0.98\n          },\n          onClick: () => setIsAutoRecognizing(prev => !prev),\n          className: `mt-3 w-full px-4 py-3 rounded-xl font-bold text-white transition-all duration-300 flex items-center justify-center gap-2 shadow-lg ${isAutoRecognizing ? \"bg-purple-600 hover:bg-purple-700\" : \"bg-yellow-600 hover:bg-yellow-700\"}`,\n          children: [/*#__PURE__*/_jsxDEV(Zap, {\n            className: `w-5 h-5 ${isAutoRecognizing ? 'animate-pulse' : ''}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 512,\n            columnNumber: 19\n          }, this), isAutoRecognizing ? \"Reconocimiento Automático ON\" : \"Activar Reconocimiento\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 504,\n          columnNumber: 15\n        }, this), cameraActive && !isAutoRecognizing && /*#__PURE__*/_jsxDEV(motion.button, {\n          whileHover: {\n            scale: 1.02\n          },\n          whileTap: {\n            scale: 0.98\n          },\n          onClick: () => recognizeSign(false),\n          disabled: isPredicting || !handsDetected,\n          className: `mt-3 w-full px-4 py-3 rounded-xl font-bold text-white transition-all duration-300 flex items-center justify-center gap-2 ${isPredicting ? \"bg-indigo-400 cursor-wait\" : \"bg-indigo-600 hover:bg-indigo-700\"} disabled:opacity-50`,\n          children: [isPredicting ? /*#__PURE__*/_jsxDEV(RefreshCw, {\n            className: \"animate-spin w-5 h-5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 528,\n            columnNumber: 35\n          }, this) : '✋', \"Reconocer Se\\xF1a (Manual)\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 519,\n          columnNumber: 15\n        }, this), (calcState.num1 || calcState.operator || calcState.num2) && /*#__PURE__*/_jsxDEV(motion.button, {\n          whileHover: {\n            scale: 1.02\n          },\n          whileTap: {\n            scale: 0.98\n          },\n          onClick: resetCalculator,\n          className: \"mt-3 w-full px-4 py-3 rounded-xl font-bold text-white transition-all duration-300 flex items-center justify-center gap-2 bg-pink-600 hover:bg-pink-700 shadow-lg\",\n          children: [/*#__PURE__*/_jsxDEV(RefreshCw, {\n            className: \"w-5 h-5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 541,\n            columnNumber: 19\n          }, this), \"Limpiar Calculadora\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 535,\n          columnNumber: 14\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 476,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `rounded-2xl shadow-xl p-5 ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'}`,\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: `font-extrabold text-xl mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`,\n          children: \"Estado del Sistema\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 550,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"flex items-center gap-2 font-medium\",\n          children: handsDetected ? /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-green-500 flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(CheckCircle, {\n              className: \"w-5 h-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 556,\n              columnNumber: 17\n            }, this), \" Mano detectada\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 555,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-red-500 flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(XCircle, {\n              className: \"w-5 h-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 560,\n              columnNumber: 17\n            }, this), \" Esperando mano\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 559,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 553,\n          columnNumber: 11\n        }, this), isAutoRecognizing && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"flex items-center gap-2 mt-2 text-purple-500 font-medium\",\n          children: [/*#__PURE__*/_jsxDEV(Zap, {\n            className: \"w-5 h-5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 566,\n            columnNumber: 17\n          }, this), \" Reconocimiento Autom\\xE1tico Activo\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 565,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 549,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 475,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"md:col-span-3 space-y-6\",\n      children: [/*#__PURE__*/_jsxDEV(motion.h2, {\n        initial: {\n          opacity: 0,\n          y: 10\n        },\n        animate: {\n          opacity: 1,\n          y: 0\n        },\n        className: `text-3xl font-extrabold text-center ${isDarkMode ? 'text-blue-300' : 'text-gray-800'}`,\n        children: \"Calculadora con Lenguaje de Se\\xF1as\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 574,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative bg-black rounded-2xl overflow-hidden shadow-2xl mx-auto max-w-2xl aspect-video\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: videoRef,\n          className: \"hidden\",\n          autoPlay: true,\n          muted: true,\n          playsInline: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 584,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: canvasRef,\n          width: 640,\n          height: 480,\n          className: \"w-full h-full object-cover\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 585,\n          columnNumber: 11\n        }, this), !cameraActive && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute inset-0 flex flex-col items-center justify-center bg-gray-900/90 text-white p-4\",\n          children: [/*#__PURE__*/_jsxDEV(Power, {\n            className: \"w-10 h-10 mb-3 text-red-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 594,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg font-medium\",\n            children: \"Pulsa \\\"Iniciar C\\xE1mara\\\" para comenzar.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 595,\n            columnNumber: 15\n          }, this), isInitializing && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mt-2 text-sm text-gray-400 flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(RefreshCw, {\n              className: \"w-5 h-5 animate-spin\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 596,\n              columnNumber: 100\n            }, this), \" Cargando MediaPipe...\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 596,\n            columnNumber: 34\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 593,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 583,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"max-w-2xl mx-auto p-4 rounded-2xl shadow-2xl space-y-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid grid-cols-5 gap-4 items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-span-2\",\n            children: /*#__PURE__*/_jsxDEV(InputBlock, {\n              title: \"N\\xDAMERO 1\",\n              value: calcState.num1,\n              isActive: calcState.activeBlock === 'num1',\n              dark: isDarkMode\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 608,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 607,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-span-1\",\n            children: /*#__PURE__*/_jsxDEV(InputBlock, {\n              title: \"OPERADOR\",\n              value: calcState.operator,\n              isActive: calcState.activeBlock === 'operator',\n              dark: isDarkMode\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 618,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 617,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-span-2\",\n            children: /*#__PURE__*/_jsxDEV(InputBlock, {\n              title: \"N\\xDAMERO 2\",\n              value: calcState.num2,\n              isActive: calcState.activeBlock === 'num2',\n              dark: isDarkMode\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 628,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 627,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 605,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(motion.button, {\n          onClick: calculateResult,\n          disabled: !isReadyToCalculate,\n          whileHover: {\n            scale: isReadyToCalculate ? 1.01 : 1\n          },\n          whileTap: {\n            scale: isReadyToCalculate ? 0.99 : 1\n          },\n          className: `w-full py-4 rounded-xl font-bold text-lg transition-all duration-300 shadow-xl flex items-center justify-center gap-3 mt-4 ${isReadyToCalculate ? \"bg-green-600 hover:bg-green-700 text-white\" : \"bg-gray-400 text-gray-700 cursor-not-allowed\"}`,\n          children: [/*#__PURE__*/_jsxDEV(Equal, {\n            className: \"w-6 h-6\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 649,\n            columnNumber: 17\n          }, this), \"CALCULAR RESULTADO\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 638,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `w-full p-6 rounded-2xl shadow-inner transition-colors duration-300 ${isDarkMode ? 'bg-gray-700 border-2 border-indigo-600' : 'bg-white border-2 border-indigo-400'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: `text-right text-sm uppercase font-semibold ${isDarkMode ? 'text-indigo-400' : 'text-indigo-600'}`,\n            children: \"Resultado\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 655,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `text-right text-6xl font-extrabold mt-1 transition-colors duration-300 ${isDarkMode ? 'text-white' : 'text-gray-900'}`,\n            children: /*#__PURE__*/_jsxDEV(motion.span, {\n              initial: {\n                y: 20,\n                opacity: 0\n              },\n              animate: {\n                y: 0,\n                opacity: 1\n              },\n              transition: {\n                duration: 0.3\n              },\n              children: calcState.result || '0'\n            }, calcState.result, false, {\n              fileName: _jsxFileName,\n              lineNumber: 659,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 658,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 654,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 602,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 573,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 472,\n    columnNumber: 5\n  }, this);\n};\n_s(SignLanguageCalculator, \"yuCHZfPuvZ2gg9gzjneuP7KZl+E=\");\n_c2 = SignLanguageCalculator;\nexport default SignLanguageCalculator;\nvar _c, _c2;\n$RefreshReg$(_c, \"InputBlock\");\n$RefreshReg$(_c2, \"SignLanguageCalculator\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","useMemo","motion","XCircle","CheckCircle","RefreshCw","Power","Zap","Equal","toast","jsxDEV","_jsxDEV","api","post","path","data","apiKey","mockPredictions","randomPrediction","Math","floor","random","length","Promise","resolve","setTimeout","prediction","confidence","createMediaPipeHandler","stream","animationFrameId","videoElement","canvasElement","onResultsCallback","runDetectionLoop","mockResults","multiHandLandmarks","Array","from","_","i","x","y","z","visibility","image","multiHandedness","label","score","canvasCtx","getContext","save","clearRect","width","height","readyState","HAVE_ENOUGH_DATA","drawImage","fillStyle","beginPath","arc","PI","fill","fillRect","font","textAlign","fillText","restore","requestAnimationFrame","initialize","video","canvas","onResults","navigator","mediaDevices","getUserMedia","srcObject","onloadedmetadata","play","error","console","stop","cancelAnimationFrame","getTracks","forEach","track","RECOGNITION_INTERVAL_MS","MIN_CONFIDENCE_THRESHOLD","safeEvaluateExpression","expr","sanitized","replace","val","Function","isFinite","String","InputBlock","title","value","isActive","dark","base","bg","border","text","titleColor","div","className","animate","scale","transition","type","stiffness","damping","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","SignLanguageCalculator","modelId","_s","videoRef","canvasRef","mediaPipeHandler","cameraActive","setCameraActive","isInitializing","setIsInitializing","handsDetected","setHandsDetected","isAutoRecognizing","setIsAutoRecognizing","isPredicting","setIsPredicting","calcState","setCalcState","num1","operator","num2","result","activeBlock","lastPredictionRef","currentLandmarksRef","recognitionIntervalRef","isDarkMode","document","body","classList","contains","results","hasHands","current","map","l","resetCalculator","startCamera","success","icon","err","stopCamera","clearInterval","calculateResult","prev","expression","evalResult","processPrediction","isNaN","Number","char","includes","recognizeSign","isAuto","landmarksPayload","response","landmarks","intervalId","window","setInterval","isReadyToCalculate","button","whileHover","whileTap","onClick","disabled","h2","initial","opacity","ref","autoPlay","muted","playsInline","span","duration","_c2","$RefreshReg$"],"sources":["C:/Users/quisp/Desktop/FinalProject/frontend/src/components/SignLanguageCalculator.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback, useMemo } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n  XCircle,\r\n  CheckCircle,\r\n  RefreshCw,\r\n  Power,\r\n  Zap,\r\n  Equal, // Icono para el botón de cálculo\r\n} from \"lucide-react\"; \r\nimport toast from \"react-hot-toast\";\r\n// Importación simulada de MediaPipe Hands Results\r\ninterface Results {\r\n    multiHandLandmarks: any[] | null;\r\n    image: HTMLCanvasElement;\r\n    multiHandedness: any[] | null;\r\n}\r\n\r\n// --- 1. Definición de la Utilidad API (SIMULADA para entorno de archivo único) ---\r\nconst api = {\r\n  post: async (path: string, data: any) => {\r\n    const apiKey = \"\"; // Clave API se inyecta\r\n    // Simulación de respuesta para demostrar el flujo de la aplicación.\r\n    // El modelo simula devolver: números (0-9), operadores (+,-,*,/), 'equal' y 'clear'.\r\n    const mockPredictions = [\"1\", \"2\", \"3\", \"4\", \"+\", \"*\", \"equal\", \"clear\"];\r\n    const randomPrediction = mockPredictions[Math.floor(Math.random() * mockPredictions.length)];\r\n\r\n    await new Promise(resolve => setTimeout(resolve, 150)); // Simular latencia\r\n\r\n    return { \r\n        data: { \r\n            prediction: randomPrediction, \r\n            confidence: Math.random() * 0.3 + 0.7 // Confianza > 0.7\r\n        }\r\n    };\r\n  }\r\n};\r\n\r\n\r\n// --- 2. Definición de la Utilidad MediaPipe (SIMULADA) ---\r\ninterface MediaPipeHandler {\r\n    initialize: (videoElement: HTMLVideoElement, canvasElement: HTMLCanvasElement, onResults: (results: Results) => void) => Promise<boolean>;\r\n    stop: () => void;\r\n}\r\n\r\nconst createMediaPipeHandler = (): MediaPipeHandler => {\r\n    let stream: MediaStream | null = null;\r\n    let animationFrameId: number | null = null;\r\n    let videoElement: HTMLVideoElement | null = null;\r\n    let canvasElement: HTMLCanvasElement | null = null;\r\n    let onResultsCallback: ((results: Results) => void) | null = null;\r\n\r\n    const runDetectionLoop = () => {\r\n        if (!videoElement || !canvasElement || !onResultsCallback) return;\r\n\r\n        // SIMULACIÓN DE DETECCIÓN Y RESULTADOS\r\n        const mockResults: Results = {\r\n            multiHandLandmarks: stream ? [\r\n                // Simulación de 21 puntos de referencia cuando la cámara está activa\r\n                Array.from({ length: 21 }, (_, i) => ({\r\n                    x: Math.random(),\r\n                    y: Math.random(),\r\n                    z: Math.random(),\r\n                    visibility: 1\r\n                }))\r\n            ] : [],\r\n            image: canvasElement,\r\n            multiHandedness: stream ? [{ label: 'Right', score: 0.9 }] : [],\r\n        } as unknown as Results; \r\n\r\n        onResultsCallback(mockResults);\r\n\r\n        // Dibujo en Canvas\r\n        const canvasCtx = canvasElement.getContext('2d');\r\n        if (canvasCtx) {\r\n            canvasCtx.save();\r\n            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);\r\n\r\n            if (videoElement.readyState === videoElement.HAVE_ENOUGH_DATA) {\r\n                canvasCtx.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);\r\n            }\r\n            \r\n            // Indicador de mano simulada\r\n            if (mockResults.multiHandLandmarks && mockResults.multiHandLandmarks.length > 0) {\r\n                 // Dibujar un círculo verde en el centro como indicador de detección\r\n                canvasCtx.fillStyle = 'rgba(74, 222, 128, 0.5)'; \r\n                canvasCtx.beginPath();\r\n                canvasCtx.arc(canvasElement.width / 2, canvasElement.height / 2, 25, 0, 2 * Math.PI);\r\n                canvasCtx.fill();\r\n            }\r\n\r\n            if (!stream) {\r\n                 // Texto de \"Cámara detenida\" si no hay stream\r\n                canvasCtx.fillStyle = 'white';\r\n                canvasCtx.fillRect(0, 0, canvasElement.width, canvasElement.height);\r\n                canvasCtx.fillStyle = 'black';\r\n                canvasCtx.font = '24px Inter, sans-serif';\r\n                canvasCtx.textAlign = 'center';\r\n                canvasCtx.fillText('Cámara detenida', canvasElement.width / 2, canvasElement.height / 2);\r\n            }\r\n            canvasCtx.restore();\r\n        }\r\n\r\n        animationFrameId = requestAnimationFrame(runDetectionLoop);\r\n    };\r\n\r\n    const initialize = async (video: HTMLVideoElement, canvas: HTMLCanvasElement, onResults: (results: Results) => void) => {\r\n        videoElement = video;\r\n        canvasElement = canvas;\r\n        onResultsCallback = onResults;\r\n\r\n        try {\r\n            stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n            video.srcObject = stream;\r\n            \r\n            await new Promise((resolve) => {\r\n                video.onloadedmetadata = () => {\r\n                    video.play();\r\n                    resolve(true);\r\n                };\r\n            });\r\n\r\n            runDetectionLoop();\r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"Error al acceder a la cámara:\", error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    const stop = () => {\r\n        if (animationFrameId !== null) {\r\n            cancelAnimationFrame(animationFrameId);\r\n            animationFrameId = null;\r\n        }\r\n        if (stream) {\r\n            stream.getTracks().forEach(track => track.stop());\r\n            stream = null;\r\n            if (videoElement) {\r\n                videoElement.srcObject = null;\r\n            }\r\n        }\r\n    };\r\n\r\n    return { initialize, stop };\r\n};\r\n// -------------------------------------------------------------------\r\n\r\n\r\n// ✅ Props para recibir el ID del modelo\r\ntype Props = {\r\n  modelId: string;\r\n};\r\n\r\n// --- Constantes de la Calculadora ---\r\nconst RECOGNITION_INTERVAL_MS = 650; // Frecuencia de reconocimiento automático\r\nconst MIN_CONFIDENCE_THRESHOLD = 0.7; // Umbral mínimo de confianza para aceptar una seña\r\n\r\n\r\n// --- Implementación Segura para la Evaluación de Expresiones ---\r\nconst safeEvaluateExpression = (expr: string): string => {\r\n  const sanitized = expr.replace(/[^0-9+\\-*/.]/g, \"\");\r\n  if (!sanitized) return \"0\";\r\n  try {\r\n    // eslint-disable-next-line no-new-func\r\n    const val = Function(`\"use strict\"; return (${sanitized});`)();\r\n    if (typeof val === \"number\" && isFinite(val)) return String(val);\r\n    return \"Error\";\r\n  } catch {\r\n    return \"Error\";\r\n  }\r\n};\r\n\r\n\r\n// --- Nuevo Tipo de Estado para la Calculadora de 3 Bloques ---\r\ninterface CalculationState {\r\n    num1: string;\r\n    operator: string;\r\n    num2: string;\r\n    result: string;\r\n    activeBlock: 'num1' | 'operator' | 'num2' | 'complete'; // 'complete' indica que está listo para el botón de cálculo\r\n}\r\n\r\n// --- UI InputBlock ---\r\nconst InputBlock: React.FC<{ title: string; value: string; isActive: boolean; dark?: boolean }> = ({ title, value, isActive, dark }) => {\r\n    const base = \"p-4 rounded-xl font-bold text-center border-2 transition-all duration-300 shadow-md\";\r\n    const bg = dark ? \"bg-gray-800\" : \"bg-white\";\r\n    const border = isActive ? \"border-indigo-400 ring-4 ring-indigo-500/30\" : dark ? \"border-gray-600\" : \"border-gray-300\";\r\n    const text = dark ? \"text-white\" : \"text-gray-900\";\r\n    const titleColor = dark ? \"text-gray-400\" : \"text-gray-600\";\r\n  \r\n    return (\r\n      <motion.div\r\n        className={`${base} ${bg} ${border}`}\r\n        animate={{ scale: isActive ? 1.03 : 1 }}\r\n        transition={{ type: \"spring\", stiffness: 300, damping: 25 }}\r\n      >\r\n        <p className={`text-sm uppercase tracking-wider ${titleColor}`}>{title}</p>\r\n        <div className={`text-3xl mt-1 ${text}`}>{value || (isActive ? \"✋\" : \"—\")}</div>\r\n      </motion.div>\r\n    );\r\n  };\r\n\r\nconst SignLanguageCalculator: React.FC<Props> = ({ modelId }) => {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  // Renombrado de mpHandler a mediaPipeHandler para consistencia con la implementación simulada\r\n  const mediaPipeHandler = useRef<MediaPipeHandler | null>(null); \r\n\r\n  const [cameraActive, setCameraActive] = useState(false);\r\n  const [isInitializing, setIsInitializing] = useState(false);\r\n  const [handsDetected, setHandsDetected] = useState(false);\r\n  const [isAutoRecognizing, setIsAutoRecognizing] = useState(true); // Auto-reconocimiento por defecto\r\n\r\n  const [isPredicting, setIsPredicting] = useState(false); // Estado de carga de la predicción\r\n\r\n  // Estado que contiene los tres bloques de la nueva interfaz\r\n  const [calcState, setCalcState] = useState<CalculationState>({\r\n      num1: '',\r\n      operator: '',\r\n      num2: '',\r\n      result: '',\r\n      activeBlock: 'num1',\r\n  });\r\n  \r\n  const lastPredictionRef = useRef<string | null>(null); \r\n  const currentLandmarksRef = useRef<any[] | null>(null); \r\n  const recognitionIntervalRef = useRef<number | null>(null);\r\n\r\n  const isDarkMode = useMemo(() => document.body.classList.contains('dark'), []);\r\n\r\n  // MediaPipe results callback\r\n  const onResults = useCallback((results: Results): void => { \r\n    const hasHands =\r\n      results.multiHandLandmarks && results.multiHandLandmarks.length > 0;\r\n    setHandsDetected(hasHands);\r\n\r\n    // Usa la primera mano detectada (simplificado)\r\n    if (hasHands && results.multiHandLandmarks[0] && results.multiHandLandmarks[0].length === 21) {\r\n      currentLandmarksRef.current = results.multiHandLandmarks[0].map((l: any) => ({ \r\n        x: l.x, \r\n        y: l.y, \r\n        z: l.z \r\n      }));\r\n    } else {\r\n      currentLandmarksRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  // Función para resetear el estado y comenzar una nueva operación\r\n  const resetCalculator = useCallback(() => {\r\n    setCalcState({ num1: '', operator: '', num2: '', result: '', activeBlock: 'num1' });\r\n  }, []);\r\n\r\n\r\n  const startCamera = useCallback(async () => {\r\n    if (!videoRef.current || !canvasRef.current) {\r\n      toast.error(\"Error: No se encontró el video/canvas\");\r\n      return;\r\n    }\r\n    setIsInitializing(true);\r\n    try {\r\n      if (mediaPipeHandler.current) {\r\n        mediaPipeHandler.current.stop();\r\n      }\r\n\r\n      mediaPipeHandler.current = createMediaPipeHandler();\r\n      const success = await mediaPipeHandler.current.initialize(\r\n        videoRef.current,\r\n        canvasRef.current,\r\n        onResults\r\n      );\r\n\r\n      if (success) {\r\n        setCameraActive(true);\r\n        setIsAutoRecognizing(true); \r\n        toast.success(\"Cámara y reconocimiento iniciados\", { icon: \"🎥\" });\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(\"Error al iniciar la cámara\");\r\n    } finally {\r\n      setIsInitializing(false);\r\n    }\r\n  }, [onResults]);\r\n\r\n  const stopCamera = useCallback(() => {\r\n    if (mediaPipeHandler.current) {\r\n      mediaPipeHandler.current.stop();\r\n      setCameraActive(false);\r\n      setIsAutoRecognizing(false);\r\n      setHandsDetected(false);\r\n      currentLandmarksRef.current = null;\r\n      lastPredictionRef.current = null;\r\n      if (recognitionIntervalRef.current !== null) {\r\n        clearInterval(recognitionIntervalRef.current);\r\n      }\r\n      toast.success(\"Cámara y reconocimiento detenidos\", { icon: \"🛑\" });\r\n    }\r\n  }, []);\r\n  \r\n  /**\r\n   * NUEVA FUNCIÓN: Ejecuta la lógica de cálculo y actualiza el estado del resultado.\r\n   */\r\n  const calculateResult = useCallback(() => {\r\n      setCalcState(prev => {\r\n        if (!prev.num1 || !prev.operator || !prev.num2) {\r\n            toast.error(\"Asegúrate de tener un número, un operador y otro número.\", { icon: \"🤔\" });\r\n            return prev;\r\n        }\r\n\r\n        const expression = `${prev.num1}${prev.operator}${prev.num2}`;\r\n        const evalResult = safeEvaluateExpression(expression);\r\n\r\n        if (evalResult === \"Error\") {\r\n            toast.error(\"Expresión inválida\", { icon: \"⚠️\" });\r\n            return { ...prev, result: \"Error\" };\r\n        }\r\n\r\n        // Cálculo exitoso: movemos el resultado a num1 y limpiamos para encadenar\r\n        toast.success(`Resultado: ${evalResult}`, { icon: \"✅\" });\r\n        return { \r\n            num1: evalResult, // El resultado se convierte en el Num1 para encadenar\r\n            operator: '', \r\n            num2: '', \r\n            result: evalResult, \r\n            activeBlock: 'operator' // Esperamos el siguiente operador\r\n        };\r\n      });\r\n  }, []);\r\n\r\n\r\n  // Función para procesar la seña detectada y actualizar el estado de la calculadora\r\n  const processPrediction = useCallback((prediction: string) => {\r\n    setCalcState(prev => {\r\n        // Lógica de borrado manual\r\n        if (prediction === \"clear\") {\r\n            return { num1: '', operator: '', num2: '', result: '', activeBlock: 'num1' };\r\n        }\r\n        \r\n        // Si hay un resultado previo (cadena de operaciones), pero la siguiente seña es un número,\r\n        // reiniciamos el cálculo e insertamos ese número como el nuevo Num1.\r\n        if (prev.result !== '' && !isNaN(Number(prediction))) {\r\n            return { num1: prediction, operator: '', num2: '', result: '', activeBlock: 'operator' };\r\n        }\r\n\r\n        // Predicciones de números (0-9)\r\n        if (!isNaN(Number(prediction)) || prediction === '.') {\r\n            const char = prediction;\r\n            if (prev.activeBlock === 'num1') {\r\n                // Prevenir múltiples puntos decimales\r\n                if (char === '.' && prev.num1.includes('.')) return prev;\r\n                // Si el resultado ya está visible, borramos y empezamos un nuevo num1\r\n                return { ...prev, num1: prev.num1 + char, activeBlock: 'operator' };\r\n            }\r\n            if (prev.activeBlock === 'num2') {\r\n                // Prevenir múltiples puntos decimales\r\n                if (char === '.' && prev.num2.includes('.')) return prev;\r\n                // Si se agrega al num2, se marca como 'complete' para habilitar el botón de resultado\r\n                return { ...prev, num2: prev.num2 + char, activeBlock: 'complete' };\r\n            }\r\n            return prev;\r\n        }\r\n\r\n        // Predicciones de operadores (+, -, *, /)\r\n        if ([\"+\", \"-\", \"*\", \"/\"].includes(prediction)) {\r\n            if (prev.activeBlock === 'operator' && prev.num1 !== '') {\r\n                // Si ya hay un operador o estamos en la etapa de operador, lo reemplazamos/establecemos\r\n                return { ...prev, operator: prediction, num2: '', activeBlock: 'num2' }; // Limpiamos num2 si cambiamos operador\r\n            }\r\n            return prev; \r\n        }\r\n\r\n        // Ignoramos la seña de \"equal\", el usuario debe presionar el botón\r\n        if (prediction === \"equal\") {\r\n            if (prev.num1 && prev.operator && prev.num2) {\r\n                // Si está completo, simularía un click en el botón de calcular.\r\n                // En este caso, simplemente mantenemos el estado, alentando el uso del botón.\r\n                toast(\"Presiona 'Calcular Resultado' para terminar la operación.\", { icon: \"👆\" });\r\n            }\r\n            return prev;\r\n        }\r\n\r\n        return prev;\r\n    });\r\n  }, []);\r\n\r\n  // Función central para predecir la seña\r\n  const recognizeSign = useCallback(async (isAuto: boolean = false) => {\r\n    if (!currentLandmarksRef.current) {\r\n      if (!isAuto) toast.error(\"No se detecta la mano\");\r\n      return;\r\n    }\r\n\r\n    if (isPredicting) return;\r\n    setIsPredicting(true);\r\n\r\n    try {\r\n      // Usamos el payload ya mapeado en onResults\r\n      const landmarksPayload = currentLandmarksRef.current;\r\n\r\n      const response = await api.post(\"/prediction/predict\", {\r\n        modelId,\r\n        landmarks: landmarksPayload,\r\n      });\r\n\r\n      const { prediction, confidence } = response.data;\r\n\r\n      // 1. Manejo de baja confianza\r\n      if (confidence < MIN_CONFIDENCE_THRESHOLD) {\r\n        if (!isAuto) toast.error(\"Seña no clara, intenta de nuevo\");\r\n        lastPredictionRef.current = null; \r\n        return;\r\n      }\r\n      \r\n      // 2. Control de duplicados en modo automático\r\n      if (isAuto && prediction === lastPredictionRef.current) {\r\n          return;\r\n      }\r\n      lastPredictionRef.current = prediction;\r\n\r\n      // 3. Procesamiento de la seña\r\n      processPrediction(prediction);\r\n      \r\n    } catch (err) {\r\n      console.error(\"Error predicting sign:\", err);\r\n      if (!isAuto) toast.error(\"Error al comunicarse con el modelo\");\r\n    } finally {\r\n      setIsPredicting(false);\r\n    }\r\n  }, [modelId, isPredicting, processPrediction]);\r\n\r\n\r\n  // EFECTO para el Reconocimiento Automático (Manejo de Intervalo)\r\n  useEffect(() => {\r\n    if (cameraActive && isAutoRecognizing) {\r\n        if (recognitionIntervalRef.current !== null) {\r\n            clearInterval(recognitionIntervalRef.current);\r\n        }\r\n\r\n        const intervalId = window.setInterval(() => {\r\n            if (currentLandmarksRef.current) {\r\n                recognizeSign(true); \r\n            }\r\n        }, RECOGNITION_INTERVAL_MS);\r\n\r\n        recognitionIntervalRef.current = intervalId as unknown as number;\r\n\r\n        return () => {\r\n            if (recognitionIntervalRef.current !== null) {\r\n                clearInterval(recognitionIntervalRef.current);\r\n                recognitionIntervalRef.current = null;\r\n            }\r\n        };\r\n    } else if (recognitionIntervalRef.current !== null) {\r\n        clearInterval(recognitionIntervalRef.current);\r\n        recognitionIntervalRef.current = null;\r\n    }\r\n  }, [cameraActive, isAutoRecognizing, recognizeSign]);\r\n\r\n  // Limpieza al desmontar el componente\r\n  useEffect(() => {\r\n      return () => {\r\n          stopCamera();\r\n      }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const isReadyToCalculate = !!(calcState.num1 && calcState.operator && calcState.num2);\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8 p-4 font-['Inter']\">\r\n      \r\n      {/* Sidebar - Controles */}\r\n      <aside className=\"md:col-span-1 space-y-6\">\r\n        <div className={`rounded-2xl shadow-xl p-5 ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'}`}>\r\n          <h3 className={`font-extrabold text-xl mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n            Controles \r\n          </h3>\r\n          \r\n          {/* Botón Iniciar/Detener Cámara */}\r\n          <motion.button\r\n            whileHover={{ scale: 1.02 }}\r\n            whileTap={{ scale: 0.98 }}\r\n            onClick={cameraActive ? stopCamera : startCamera}\r\n            disabled={isInitializing}\r\n            className={`w-full px-4 py-3 rounded-xl font-bold text-white transition-all duration-300 flex items-center justify-center gap-2 shadow-lg ${\r\n              isInitializing ? \"bg-gray-500 cursor-not-allowed\" : \r\n              cameraActive ? \"bg-red-600 hover:bg-red-700\" : \"bg-blue-600 hover:bg-blue-700\"\r\n            }`}\r\n          >\r\n            {isInitializing ? (\r\n              <RefreshCw className=\"animate-spin w-5 h-5\" />\r\n            ) : cameraActive ? (\r\n              <Power className=\"w-5 h-5\" />\r\n            ) : (\r\n              <Power className=\"w-5 h-5\" />\r\n            )}\r\n            {isInitializing ? \"Inicializando...\" : cameraActive ? \"Detener Cámara\" : \"Iniciar Cámara\"}\r\n          </motion.button>\r\n\r\n          {/* Botón de Reconocimiento Automático (Toggle) */}\r\n          {cameraActive && (\r\n              <motion.button\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                  onClick={() => setIsAutoRecognizing(prev => !prev)}\r\n                  className={`mt-3 w-full px-4 py-3 rounded-xl font-bold text-white transition-all duration-300 flex items-center justify-center gap-2 shadow-lg ${\r\n                      isAutoRecognizing ? \"bg-purple-600 hover:bg-purple-700\" : \"bg-yellow-600 hover:bg-yellow-700\"\r\n                  }`}\r\n              >\r\n                  <Zap className={`w-5 h-5 ${isAutoRecognizing ? 'animate-pulse' : ''}`} />\r\n                  {isAutoRecognizing ? \"Reconocimiento Automático ON\" : \"Activar Reconocimiento\"}\r\n              </motion.button>\r\n          )}\r\n\r\n          {/* Botón de Reconocimiento Manual (solo visible si el auto-rec está apagado) */}\r\n          {cameraActive && !isAutoRecognizing && (\r\n              <motion.button\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                  onClick={() => recognizeSign(false)}\r\n                  disabled={isPredicting || !handsDetected}\r\n                  className={`mt-3 w-full px-4 py-3 rounded-xl font-bold text-white transition-all duration-300 flex items-center justify-center gap-2 ${\r\n                    isPredicting ? \"bg-indigo-400 cursor-wait\" : \"bg-indigo-600 hover:bg-indigo-700\"\r\n                  } disabled:opacity-50`}\r\n              >\r\n                  {isPredicting ? <RefreshCw className=\"animate-spin w-5 h-5\" /> : '✋'}\r\n                  Reconocer Seña (Manual)\r\n              </motion.button>\r\n          )}\r\n\r\n          {/* Botón de Limpiar */}\r\n          {(calcState.num1 || calcState.operator || calcState.num2) && (\r\n             <motion.button\r\n                  whileHover={{ scale: 1.02 }}\r\n                  whileTap={{ scale: 0.98 }}\r\n                  onClick={resetCalculator}\r\n                  className=\"mt-3 w-full px-4 py-3 rounded-xl font-bold text-white transition-all duration-300 flex items-center justify-center gap-2 bg-pink-600 hover:bg-pink-700 shadow-lg\"\r\n              >\r\n                  <RefreshCw className=\"w-5 h-5\" />\r\n                  Limpiar Calculadora\r\n              </motion.button>\r\n          )}\r\n\r\n        </div>\r\n\r\n        {/* Estado de la Detección */}\r\n        <div className={`rounded-2xl shadow-xl p-5 ${isDarkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white border border-gray-200'}`}>\r\n          <h3 className={`font-extrabold text-xl mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n            Estado del Sistema\r\n          </h3>\r\n          <p className=\"flex items-center gap-2 font-medium\">\r\n            {handsDetected ? (\r\n              <span className=\"text-green-500 flex items-center gap-2\">\r\n                <CheckCircle className=\"w-5 h-5\" /> Mano detectada\r\n              </span>\r\n            ) : (\r\n              <span className=\"text-red-500 flex items-center gap-2\">\r\n                <XCircle className=\"w-5 h-5\" /> Esperando mano\r\n              </span>\r\n            )}\r\n          </p>\r\n          {isAutoRecognizing && (\r\n              <p className=\"flex items-center gap-2 mt-2 text-purple-500 font-medium\">\r\n                <Zap className=\"w-5 h-5\" /> Reconocimiento Automático Activo\r\n              </p>\r\n          )}\r\n        </div>\r\n      </aside>\r\n\r\n      {/* Main Area - Video y Pantalla de la Calculadora */}\r\n      <section className=\"md:col-span-3 space-y-6\">\r\n        <motion.h2\r\n          initial={{ opacity: 0, y: 10 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className={`text-3xl font-extrabold text-center ${isDarkMode ? 'text-blue-300' : 'text-gray-800'}`}\r\n        >\r\n          Calculadora con Lenguaje de Señas\r\n        </motion.h2>\r\n\r\n        {/* Contenedor de Video/Canvas */}\r\n        <div className=\"relative bg-black rounded-2xl overflow-hidden shadow-2xl mx-auto max-w-2xl aspect-video\">\r\n          <video ref={videoRef} className=\"hidden\" autoPlay muted playsInline />\r\n          <canvas\r\n            ref={canvasRef}\r\n            width={640}\r\n            height={480}\r\n            className=\"w-full h-full object-cover\"\r\n          />\r\n\r\n          {!cameraActive && (\r\n            <div className=\"absolute inset-0 flex flex-col items-center justify-center bg-gray-900/90 text-white p-4\">\r\n              <Power className=\"w-10 h-10 mb-3 text-red-400\" />\r\n              <p className=\"text-lg font-medium\">Pulsa \"Iniciar Cámara\" para comenzar.</p>\r\n              {isInitializing && <p className=\"mt-2 text-sm text-gray-400 flex items-center gap-2\"><RefreshCw className=\"w-5 h-5 animate-spin\" /> Cargando MediaPipe...</p>}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Bloques de Entrada de la Calculadora (3 Bloques) */}\r\n        <div \r\n            className=\"max-w-2xl mx-auto p-4 rounded-2xl shadow-2xl space-y-4\"\r\n        >\r\n            <div className=\"grid grid-cols-5 gap-4 items-center\">\r\n                {/* Bloque Número 1 */}\r\n                <div className=\"col-span-2\">\r\n                    <InputBlock \r\n                        title=\"NÚMERO 1\" \r\n                        value={calcState.num1} \r\n                        isActive={calcState.activeBlock === 'num1'} \r\n                        dark={isDarkMode}\r\n                    />\r\n                </div>\r\n\r\n                {/* Bloque Operador */}\r\n                <div className=\"col-span-1\">\r\n                    <InputBlock \r\n                        title=\"OPERADOR\" \r\n                        value={calcState.operator} \r\n                        isActive={calcState.activeBlock === 'operator'} \r\n                        dark={isDarkMode}\r\n                    />\r\n                </div>\r\n\r\n                {/* Bloque Número 2 */}\r\n                <div className=\"col-span-2\">\r\n                    <InputBlock \r\n                        title=\"NÚMERO 2\" \r\n                        value={calcState.num2} \r\n                        isActive={calcState.activeBlock === 'num2'} \r\n                        dark={isDarkMode}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* BOTÓN DE CALCULAR RESULTADO */}\r\n            <motion.button\r\n                onClick={calculateResult}\r\n                disabled={!isReadyToCalculate}\r\n                whileHover={{ scale: isReadyToCalculate ? 1.01 : 1 }}\r\n                whileTap={{ scale: isReadyToCalculate ? 0.99 : 1 }}\r\n                className={`w-full py-4 rounded-xl font-bold text-lg transition-all duration-300 shadow-xl flex items-center justify-center gap-3 mt-4 ${\r\n                    isReadyToCalculate \r\n                        ? \"bg-green-600 hover:bg-green-700 text-white\" \r\n                        : \"bg-gray-400 text-gray-700 cursor-not-allowed\"\r\n                }`}\r\n            >\r\n                <Equal className=\"w-6 h-6\" />\r\n                CALCULAR RESULTADO\r\n            </motion.button>\r\n\r\n            {/* Pantalla del Resultado */}\r\n            <div className={`w-full p-6 rounded-2xl shadow-inner transition-colors duration-300 ${isDarkMode ? 'bg-gray-700 border-2 border-indigo-600' : 'bg-white border-2 border-indigo-400'}`}>\r\n                <p className={`text-right text-sm uppercase font-semibold ${isDarkMode ? 'text-indigo-400' : 'text-indigo-600'}`}>\r\n                    Resultado\r\n                </p>\r\n                <div className={`text-right text-6xl font-extrabold mt-1 transition-colors duration-300 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\r\n                    <motion.span\r\n                        key={calcState.result} \r\n                        initial={{ y: 20, opacity: 0 }}\r\n                        animate={{ y: 0, opacity: 1 }}\r\n                        transition={{ duration: 0.3 }}\r\n                    >\r\n                        {calcState.result || '0'}\r\n                    </motion.span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SignLanguageCalculator;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}